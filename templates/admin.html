<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل ادمین SSH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazir:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazir', sans-serif; direction: rtl; background-color: #f4f6f9; }
        .sidebar { height: 100vh; background-color: #2c3e50; color: white; padding-top: 20px; }
        .sidebar a { color: white; text-decoration: none; display: block; padding: 10px 15px; }
        .sidebar a:hover { background-color: #34495e; }
        .card { border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .table thead th { background-color: #2c3e50; color: white; }
        .btn-custom { background-color: #2c3e50; color: white; }
        .btn-custom:hover { background-color: #1a252f; }
        .form-control { margin-bottom: 10px; }
        @media (max-width: 768px) {
            .sidebar { height: auto; }
            .col-md-9 { margin-top: 20px; }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-none d-md-block sidebar">
                <h4 class="text-center">منو</h4>
                <a href="#dashboard">داشبورد</a>
                <a href="#users">کاربران</a>
                <a href="#requests">درخواست‌ها</a>
                <a href="#servers">سرورها</a>
                <a href="#settings">تنظیمات</a>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <h1 class="my-4">پنل مدیریت ربات SSH</h1>

                <!-- داشبورد -->
                <div class="card mb-4" id="dashboard">
                    <div class="card-body">
                        <h5>آمار کلی</h5>
                        <div class="row">
                            <div class="col-md-4"><div class="card bg-primary text-white">تعداد کاربران: {{ user_count }}</div></div>
                            <div class="col-md-4"><div class="card bg-success text-white">درخواست‌های در انتظار: {{ request_count }}</div></div>
                        </div>
                    </div>
                </div>

                <!-- کاربران -->
                <div class="card mb-4" id="users">
                    <div class="card-body">
                        <h5>لیست کاربران</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr><th>نام کاربری</th><th>رمز</th><th>انقضا</th><th>سرور</th><th>پورت</th><th>عملیات</th></tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr><td>{{ user[0] }}</td><td>{{ user[1] }}</td><td>{{ user[2] }}</td><td>{{ user[3] }}</td><td>{{ user[4] }}</td><td><button class="btn btn-danger btn-sm">حذف</button></td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- درخواست‌ها -->
                <div class="card mb-4" id="requests">
                    <div class="card-body">
                        <h5>درخواست‌های کارت به کارت</h5>
                        <table class="table table-striped">
                            <thead><tr><th>آیدی</th><th>کاربر</th><th>تاریخ</th><th>عملیات</th></tr></thead>
                            <tbody>
                                {% for request in requests %}
                                <tr><td>{{ request[0] }}</td><td>{{ request[1] }}</td><td>{{ request[2] }}</td><td>
                                    <form action="{{ url_for('approve_request_web', request_id=request[0]) }}" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-custom btn-sm">تأیید</button>
                                    </form>
                                    <form action="{{ url_for('reject_request_web', request_id=request[0]) }}" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger btn-sm">رد</button>
                                    </form>
                                </td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- سرورها -->
                <div class="card mb-4" id="servers">
                    <div class="card-body">
                        <h5>مدیریت سرورها</h5>
                        <table class="table table-striped">
                            <thead><tr><th>هاست</th><th>پورت</th><th>کشور</th><th>عملیات</th></tr></thead>
                            <tbody>
                                {% for server in servers %}
                                <tr><td>{{ server.host }}</td><td>{{ server.port }}</td><td>{{ server.country }}</td><td><button class="btn btn-danger btn-sm">حذف</button></td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <form method="post" action="{{ url_for('update_server') }}">
                            <div class="row"><div class="col-md-4"><input type="text" name="host" class="form-control" placeholder="هاست" required></div>
                            <div class="col-md-2"><input type="number" name="port" class="form-control" placeholder="پورت" required></div>
                            <div class="col-md-4"><input type="text" name="country" class="form-control" placeholder="کشور (مثلاً 🇮🇷)" required></div>
                            <div class="col-md-2"><button type="submit" class="btn btn-custom">افزودن</button></div></div>
                        </form>
                    </div>
                </div>

                <!-- تنظیمات -->
                <div class="card mb-4" id="settings">
                    <div class="card-body">
                        <h5>تنظیمات</h5>
                        <form>
                            <div class="mb-3"><label>آیدی ادمین</label><input type="number" class="form-control" value="{{ config.ADMIN_ID }}" disabled></div>
                            <div class="mb-3"><label>URL Webhook</label><input type="text" class="form-control" value="{{ config.CALLBACK_URL }}/webhook/{{ config.TOKEN }}" disabled></div>
                            <button type="button" class="btn btn-custom">ذخیره</button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>